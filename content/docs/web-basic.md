+++
title = 'サイト構築基本'
date = 2024-04-20T23:50:40+09:00
draft = false
+++

## Webブラウザ
Webページは[HTML](./markup.md)ファイル(以下の例はhello.html)をWebブラウザで読み込むことで表示される。

```
<html>
    <head>
        <title>はじめてのWebサイト</title>
    </head>
    <body>こんにちは、世界の読者へ</body>
</html>
```
![Webブラウザ](/images/web-browser.png)  

## Webサーバー
これをWebサーバーと呼ばれるソフトゥエアが参照している指定のフォルダに置くと同じネットワーク内（家庭や職場などのLAN(LocalAreaNetwork)）からWebサイトを見ることができる。サーバーとはサービスを配るものという意味である。

```
hoge@web-server:/var/www/html$ ls hello.html
hello.html
hoge@web-server:/var/www/html$ ifconfig | grep inet
        inet 192.168.0.101  netmask 255.255.255.0  broadcast 192.168.0.255
```
![ローカルWebサーバー](/images/local-web-server.png)  

### index.html
なお、HTMLファイル名がindex.htmlの場合、Webサーバー上のファイル名を指定しなくても、Webブラウザーはindex.htmlを読み込むというルールがある。
```
hoge@web-server:/var/www/html$ mv hello.html index.html
hoge@web-server:/var/www/html$ ls index.html
index.html
```
![ローカルWebサーバーIndex](/images/local-web-server-index.png)

## インターネット
これを全世界に公開するためには、Webサーバーがつながっているルーター等のWAN(WideAreaNetwork)側のポートを空ける必要がある。なお、通信は必ずクライアント（ここではWebブラウザ）からサーバーに対する要求とそれに対する応答という形で行われる。
![インターネット](/images/internet.png)

### IPアドレス
IPアドレスとはネットワーク上の住所を示すもので、それぞれの機器に振られる。
上図の場合の例として以下抜粋する。
|機器|IPアドレス|
|:---|:---|
|LAN1|192.168.0.1|
|PC1|192.168.0.101|
|PC2|192.168.0.102|
|WAN1|172.217.26.227|
|LAN2|192.168.10.1|
|タブレット|192.168.10.3|

### ポート
ポートとはアプリケーションがその番号で通信することによって混信しないようにするためのものである。
実は通信データはテレビの電波のように多くのチャンネルが一斉に送信してくるが、IPアドレスとポート番号を指定することで、チャンネル合わせをするかのように指定のものを受け取っているのである。

なお、httpはデフォルトでは80番のポートを空ける必要がある。 `http://172.217.26.227:80/`  
デフォルトの場合、ポート番号は省略できる。`http://172.217.26.227`  
80番以外でも通信できるが、その場合はポート番号を必ず指定しないとならない。`http://172.217.26.227:8080/`  

### ドメイン
IPアドレスは人間としては分かりにくいのでドメイン（`google.co.jp`など）と呼ばれる名前をつけて分かりやすくしている。

![ドメイン](/images/domain.png)

#### ドメイン取得
そのためには、まずレジストラと呼ばれるサービス提供会社にお金を払ってドメインを取得する必要がある。
なぜ、お金を払う必要があるかというと、本来ドメインは無料なのであるが、早い者勝ちとなる。
レジストラという業者がドメインを取得したあと有料で販売するからである。かといって一般にはレジストラを用いずにドメイン登録を行うことは逆にコストがとても高い。

#### DNS
ドメインを取得したあと、DNSサーバー運営会社にて設定を行い、自身が管理しているサーバーのWAN側のIPアドレスに紐づける。  
もちろん内部でLAN側にこれを紐づけるのはサーバー管理者が行う。
|||
|:---|:---|
|ドメイン|www.google.co.jp|
|WAN側|172.217.26.227:80|
|LAN側|192.168.0.101:80|

DNSというのは"Domain Name Service"の略で、このサービスをしている会社は無料でサービスを提供してくれているものが多い。サーバー管理者が自身でDNSサーバーを構築してもよい。
そして、上図のようにクライアントがまずDNSサーバーに対して名前解決（IPアドレスとドメインの紐付け）を行ってから、サーバーに要求を行い処理を完結させる。  
なお、`www`はサブドメインと呼ばれ、サーバー管理者が自由に名前をつけて自由にDNSサーバーに登録することができる。

## 発展：サイト構成
さて、httpとはHyperTextTransferProtocolの略で通信規約の１つである。
このプロトコルの仕様上は、要求に対する応答の中身がHTMLでありさえすればWebブラウザはサイトを表示する。この仕様を利用した様々なサイト構成が存在する。

### 静的サイト
静的サイトは上記で説明したとおりHTMLを始めとするWebリソース(js, cssなど)をWebサーバーの指定フォルダに置くことで構成される。
![静的サイト](/images/static-site.png)

### 動的サイト
動的サイトは[Webサーバー](https://ja.wikipedia.org/wiki/Web%E3%82%B5%E3%83%BC%E3%83%90)から[Servert](https://ja.wikipedia.org/wiki/Java_Servlet)などに処理を委譲してその処理結果をやはりHTMLで応答するという処理方式を採用している。通常DBを用いて状態を管理する。Google検索サイト、ニュースサイト、証券取引サイトなど、データ入力やデータ収集が必要なサイトのほとんどがこの構成を取る。  
なお、この時のWebサーバーをFrontEnd、Servertなど（CGIやDjango, ...）をBackendと呼ぶ。Clientから見た時にはどちらもサーバーなのであるが、前にあるか後ろにあるかといった意味である。
有名な[WordPress](https://daeuwordpress.com/wordpress-system/)はFrontEndとBackEndが統合された構成になっている。
![静的サイト](/images/dynamic-site.png)

#### アプリ
アプリはネットワークを利用しない特殊なアプリを除いては、動的サービスの一種でフロントエンドの代わりにAPIが用いられている。プロトコルとしてはhttp([https](https://ja.wikipedia.org/wiki/HTTPS))を用いているが、応答の内容はHTMLではなくJSONと呼ばれるデータファイルとなる。
##### Jsonサンプル
```
{
  "email": "hoge@google.co.jp",
  "phone": 819012345678,
  "password": "hogehoge"
}
```
Facebook, 地図アプリ, 電話アプリなどほとんどがAPIを用いてアプリを開発している。
![アプリ](/images/app.png)
